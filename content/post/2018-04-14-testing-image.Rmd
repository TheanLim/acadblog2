---
title: Testing Image
author: ''
date: '2018-04-14'
slug: testing-image
categories: []
tags: []
header:
  caption: ''
  image: ''
---

```{r setup, include=FALSE}
library(knitr)
opts_chunk$set(message = FALSE, warning = FALSE)
options(width = 100, dplyr.width = 100)
library(methods)
library(ggplot2)
theme_set(theme_light())
```

The following images are taken from [DesignCrowd](https://blog.designcrowd.com/article/549/famous-landmarks-of-the-world-without-people). 


![Image with tourist aka `tour`](/img/imagecompression/paris_tourist.jpg) ![Image with NO tourist aka `no_tour`](/img/paris_no_tourist.jpg)

This first image is an image with tourists ( I call it as `tour`) while the second one has no tourist -- `no_tour`.

![Rome](/img/rome.jpg)
This is another `new` image that is different from the above two.

The goals are:

* Use PCA to compress the `tour` image
* Test the generalizability of the PC loadings obtained from `tour` image to other similar image (i.e., the `no_tour` image) and a very different image (i.e. `new` image).

# Loading pictures and standardizing the sizes

First, let's load the pictures and look at the dimensions.  
```{r readingJPEG}
library(jpeg)
path = "C:/Users/mirac/Desktop/Work/acadblog2/static/img/imagecompression"
tour = readJPEG(paste(path,"paris_tourist.jpg", sep = "/"))
no_tour = readJPEG(paste(path,"paris_no_tourist.jpg", sep = "/"))
new = readJPEG(paste(path,"rome.jpg", sep = "/"))
```
```{r dim}
dim(tour); dim(no_tour); dim(new)
```

The three pistures do not have the same dimensions so let's resize them to `458, 715, 3.` The `3` represents `R`, `G`, and `B`, the three color schemes from the images.  

```{r standard}
library("EBImage")
# scale to a specific width and height
tour <- resize(tour, w = 458, h = 715)
new <- resize(new, w = 458, h = 715)

# extract the pixel array
tour <- as.array(tour)
new <- as.array(new)
```

# The `tour` Image.

## PCA

Break down each color scheme into three dataframe and perform PCA. 

```{r breakRGB}
rtour = tour[, ,1]
gtour = tour[, ,2]
btour = tour[, ,3]
```


```{r PCA}
prtour = prcomp(rtour, center = FALSE)
pgtour = prcomp(gtour, center = FALSE)
pbtour = prcomp(btour, center = FALSE)

tour.pca = list(prtour, pgtour, pbtour)
```

## Scree Plot and Cumulative Variation Plot

Take a look at the Scree plot of the PCA.

```{r screeplot, fig.cap = "The **elbow** of the screeplot is between the fourth and the fifth PC"}
library(dplyr)
# Create a dataframe for easier plotting
df = data.frame(scheme = rep(c("R", "G", "B"),each =458), 
                index = rep(1:458,  3),
                var = c(prtour$sdev^2,
                        pgtour$sdev^2, 
                        pbtour$sdev^2))

df %<>% group_by(scheme) %>%
  mutate(propvar =100*var/sum(var)) %>%
  mutate(cumsum = cumsum(propvar)) %>%
  ungroup()

#plot
library(ggplot2)
#relevel to make it look nicer
df$scheme = factor(df$scheme,levels(df$scheme)[c(3,2,1)])

df %>% ggplot(aes( x = index, y = propvar, fill = scheme)) + 
    geom_bar(stat="identity") + 
    labs(title="Screeplot of Principal Component", x ="Principal Component", 
         y="% of Variance") + geom_line()  + 
    scale_x_continuous(limits = c(0,30)) +
    facet_wrap(~scheme)
```